name: Build and push

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: get current branch
      run: export BRANCH=`git branch 2>/dev/null | grep '^*' | colrm 1 2`
    - name: Build
      run: docker build -t docker.pkg.github.com/$GITHUB_REPOSITORY/$BRANCH:latest .
    - name: Login
      run: docker login docker.pkg.github.com --username andrchalov --password $DOCKER_TOKEN
      env:
        DOCKER_TOKEN: ${{ secrets.DOCKER_TOKEN }}
    - name: Push
      run: docker push docker.pkg.github.com/$GITHUB_REPOSITORY/app:latest
